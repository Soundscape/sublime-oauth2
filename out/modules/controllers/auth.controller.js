(function(){var e,n,t;t=require("passport"),e=require("passport-http").BasicStrategy,n=require("passport-http-bearer").Strategy,module.exports=function(r){return t.use(new e(function(e,n,t){return r.models.user.findOne().where({username:e}).exec(function(e,r){return e?t(e):r?n!==r.password?t(null,!1):t(null,r):t(null,!1)})})),t.use("client-basic",new e(function(e,n,t){return r.models.client.findOne().where({name:e}).exec(function(e,r){return e?t(e):r&&r.secret===n?t(null,r):t(null,!1)})})),t.use(new n(function(e,n){return r.models.token.findOne().where({value:e}).exec(function(e,t){return e?n(e):t?r.models.user.findOne().where({id:t.userId}).exec(function(e,t){return e?n(e):t?n(null,t,{scope:"*"}):n(null,!1)}):n(null,!1)})})),{isAuthenticated:t.authenticate(["basic","bearer"],{session:!1}),isClientAuthenticated:t.authenticate("client-basic",{session:!1}),isBearerAuthenticated:t.authenticate("bearer",{session:!1})}}}).call(this);
