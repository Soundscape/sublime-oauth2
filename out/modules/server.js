(function(){var t,e,r,o,i,s,u,n,c,l,a,h,p,d,f=function(t,e){function r(){this.constructor=t}for(var o in e)q.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},q={}.hasOwnProperty;o=require("lodash"),e=require("sublime-core"),t=require("sublime-application"),c=require("express"),a=require("passport"),s=require("body-parser"),p=require("express-session"),n=require("consolidate"),d=require("./controllers/user.controller"),h=require("./controllers/profile.controller"),i=require("./controllers/auth.controller"),l=require("./controllers/oauth2.controller"),u=require("./controllers/client.controller"),r=function(e){function r(e,o){r.__super__.constructor.call(this,o),this.ctx=e,this.ctrl={user:d(this.ctx),profile:h(this.ctx),auth:i(this.ctx),oauth2:l(this.ctx),client:u(this.ctx)},this.app=new t.Application(this.options.server),this.app.use(function(t){return function(e){var r;return e.engine("html",n.handlebars),e.set("view engine","html"),e.set("views","views"),e.use(s.urlencoded({extended:!0})),e.use(p({secret:t.options.session.secret,saveUninitialized:!0,resave:!0})),e.use(a.initialize()),e.use(function(t,e,r){return e.header("Access-Control-Allow-Origin","*"),r()}),r=c.Router(),r.route("/users").post(t.ctrl.user.post).get(t.ctrl.auth.isAuthenticated,t.ctrl.user.get),r.route("/profile").get(t.ctrl.auth.isAuthenticated,t.ctrl.profile.get),r.route("/clients").post(t.ctrl.auth.isAuthenticated,t.ctrl.client.post).get(t.ctrl.auth.isAuthenticated,t.ctrl.client.get),r.route("/oauth2/authorize").get(t.ctrl.auth.isAuthenticated,t.ctrl.oauth2.authorization).post(t.ctrl.auth.isAuthenticated,t.ctrl.oauth2.decision),r.route("/oauth2/token").post(t.ctrl.auth.isClientAuthenticated,t.ctrl.oauth2.token),e.use("/api",r)}}(this))}return f(r,e),r.prototype.use=function(t){return this.app.use(t)},r.prototype.start=function(t){return this.app.start(t)},r}(e.CoreObject),module.exports=r}).call(this);
